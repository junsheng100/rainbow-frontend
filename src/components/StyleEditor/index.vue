<template>
  <div class="style-editor">
    <el-button
      type="success"
      @click="visible = true"
      :icon="Setting"
      size="large"
    >
      Ê†∑ÂºèÁºñËæëÂô®
    </el-button>

    <el-drawer
      v-model="visible"
      title="üéõÔ∏è Ê†∑ÂºèÁºñËæëÂô®"
      direction="rtl"
      size="500px"
      :with-header="true"
    >
      <div class="style-editor-content">
        <!-- Â∏ÉÂ±ÄËÆæÁΩÆ -->
        <el-card class="layout-settings" shadow="never">
          <template #header>
            <div class="card-header">
              <span class="card-title">üì± Â∏ÉÂ±ÄËÆæÁΩÆ</span>
              <el-tooltip content="Ë∞ÉÊï¥ËèúÂçïÂíåÂ∏ÉÂ±Ä‰ΩçÁΩÆ" placement="top">
                <el-icon><QuestionFilled /></el-icon>
              </el-tooltip>
            </div>
          </template>
          
          <el-form :model="layoutSettings" label-width="80px">
            <el-form-item label="ËèúÂçï‰ΩçÁΩÆ">
              <el-radio-group v-model="layoutSettings.menuPosition" @change="updateLayout">
                <el-radio label="left">Â∑¶‰æß</el-radio>
                <el-radio label="right">Âè≥‰æß</el-radio>
                <el-radio label="top">È°∂ÈÉ®</el-radio>
              </el-radio-group>
            </el-form-item>
            
            <el-form-item label="ËèúÂçïÊäòÂè†">
              <el-switch 
                v-model="layoutSettings.menuCollapsed" 
                @change="updateLayout"
                active-text="Â∑≤ÊäòÂè†"
                inactive-text="Â∑≤Â±ïÂºÄ"
              />
            </el-form-item>
          </el-form>
        </el-card>

        <!-- Â§¥ÈÉ®Ê†∑Âºè -->
        <el-card class="header-style" shadow="never">
          <template #header>
            <div class="card-header">
              <span class="card-title">üß≠ Â§¥ÈÉ®Ê†∑Âºè</span>
              <el-tooltip content="Ëá™ÂÆö‰πâÂ§¥ÈÉ®ÂØºËà™Ê†∑Âºè" placement="top">
                <el-icon><QuestionFilled /></el-icon>
              </el-tooltip>
            </div>
          </template>
          
          <el-form :model="headerStyle" label-width="80px">
            <el-form-item label="È´òÂ∫¶">
              <el-input-number 
                v-model="headerStyle.height" 
                :min="40" 
                :max="100" 
                @change="updateHeader"
                controls-position="right"
              />
              <span class="unit">px</span>
            </el-form-item>
            
            <el-form-item label="ËÉåÊôØËâ≤">
              <el-color-picker 
                v-model="headerStyle.background" 
                @change="updateHeader"
                show-alpha
                size="large"
              />
            </el-form-item>
            
            <el-form-item label="Èò¥ÂΩ±">
              <el-input 
                v-model="headerStyle.shadow" 
                placeholder="CSS box-shadow ÂÄº"
                @change="updateHeader"
              />
            </el-form-item>

            <el-form-item label="ÊñáÂ≠óÈ¢úËâ≤">
              <el-color-picker 
                v-model="headerStyle.textColor" 
                @change="updateHeader"
                size="large"
              />
            </el-form-item>
          </el-form>
        </el-card>

        <!-- È°µÈù¢Ê†áÁ≠æÊ†∑Âºè -->
        <el-card class="tabs-style" shadow="never">
          <template #header>
            <div class="card-header">
              <span class="card-title">üè∑Ô∏è È°µÈù¢Ê†áÁ≠æ</span>
              <el-tooltip content="Ëá™ÂÆö‰πâÈ°µÈù¢Ê†áÁ≠æÊ†∑Âºè" placement="top">
                <el-icon><QuestionFilled /></el-icon>
              </el-tooltip>
            </div>
          </template>
          
          <el-form :model="tabsStyle" label-width="80px">
            <el-form-item label="È´òÂ∫¶">
              <el-input-number 
                v-model="tabsStyle.height" 
                :min="30" 
                :max="60" 
                @change="updateTabs"
                controls-position="right"
              />
              <span class="unit">px</span>
            </el-form-item>
            
            <el-form-item label="ËÉåÊôØËâ≤">
              <el-color-picker 
                v-model="tabsStyle.background" 
                @change="updateTabs"
                size="large"
              />
            </el-form-item>
            
            <el-form-item label="ËæπÊ°ÜËâ≤">
              <el-color-picker 
                v-model="tabsStyle.borderColor" 
                @change="updateTabs"
                size="large"
              />
            </el-form-item>

            <el-form-item label="ÊøÄÊ¥ªËâ≤">
              <el-color-picker 
                v-model="tabsStyle.activeColor" 
                @change="updateTabs"
                size="large"
              />
            </el-form-item>
          </el-form>
        </el-card>

        <!-- ËÉåÊôØËÆæÁΩÆ -->
        <el-card class="background-settings" shadow="never">
          <template #header>
            <div class="card-header">
              <span class="card-title">üñºÔ∏è ËÉåÊôØËÆæÁΩÆ</span>
              <el-tooltip content="Ëá™ÂÆö‰πâÈ°µÈù¢ËÉåÊôØÊ†∑Âºè" placement="top">
                <el-icon><QuestionFilled /></el-icon>
              </el-tooltip>
            </div>
          </template>
          
          <el-form :model="backgroundSettings" label-width="80px">
            <el-form-item label="ËÉåÊôØÁ±ªÂûã">
              <el-select v-model="backgroundSettings.type" @change="updateBackground">
                <el-option label="Á∫ØËâ≤ËÉåÊôØ" value="color" />
                <el-option label="ÂõæÁâáËÉåÊôØ" value="image" />
                <el-option label="Âä®ÁîªËÉåÊôØ" value="animation" />
              </el-select>
            </el-form-item>
            
            <el-form-item v-if="backgroundSettings.type === 'color'" label="ËÉåÊôØËâ≤">
              <el-color-picker 
                v-model="backgroundSettings.color" 
                @change="updateBackground"
                show-alpha
                size="large"
              />
            </el-form-item>
            
            <el-form-item v-if="backgroundSettings.type === 'image'" label="ËÉåÊôØÂõæÁâá">
              <el-input 
                v-model="backgroundSettings.image" 
                placeholder="ÂõæÁâáURLÂú∞ÂùÄ"
                @change="updateBackground"
              />
              <div class="image-preview" v-if="backgroundSettings.image">
                <img :src="backgroundSettings.image" alt="ËÉåÊôØÈ¢ÑËßà" />
              </div>
            </el-form-item>
            
            <el-form-item v-if="backgroundSettings.type === 'animation'" label="Âä®ÁîªÁ±ªÂûã">
              <el-select v-model="backgroundSettings.animation" @change="updateBackground">
                <el-option label="Á≤íÂ≠êÂä®Áîª" value="particles" />
                <el-option label="Ê≥¢Êµ™Âä®Áîª" value="waves" />
                <el-option label="Âá†‰ΩïÂä®Áîª" value="geometric" />
              </el-select>
            </el-form-item>

            <el-form-item label="ÈÄèÊòéÂ∫¶">
              <el-slider
                v-model="backgroundSettings.opacity"
                :min="0.1"
                :max="1"
                :step="0.1"
                @change="updateBackground"
                show-input
                :format-tooltip="(val: number) => Math.round(val * 100) + '%'"
              />
            </el-form-item>
          </el-form>
        </el-card>

        <!-- Â≠ó‰ΩìËÆæÁΩÆ -->
        <el-card class="typography-settings" shadow="never">
          <template #header>
            <div class="card-header">
              <span class="card-title">‚úíÔ∏è Â≠ó‰ΩìËÆæÁΩÆ</span>
              <el-tooltip content="Ëá™ÂÆö‰πâÂ≠ó‰ΩìÂíåÊñáÂ≠óÊ†∑Âºè" placement="top">
                <el-icon><QuestionFilled /></el-icon>
              </el-tooltip>
            </div>
          </template>
          
          <el-form :model="typographySettings" label-width="80px">
            <el-form-item label="Â≠ó‰ΩìÊóè">
              <el-select v-model="typographySettings.fontFamily" @change="updateTypography">
                <el-option label="Á≥ªÁªüÈªòËÆ§" value="-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif" />
                <el-option label="ÂæÆËΩØÈõÖÈªë" value="Microsoft YaHei, sans-serif" />
                <el-option label="ÊÄùÊ∫êÈªë‰Ωì" value="Source Han Sans CN, sans-serif" />
                <el-option label="ËãπÊñπÂ≠ó‰Ωì" value="PingFang SC, sans-serif" />
                <el-option label="Helvetica" value="Helvetica, Arial, sans-serif" />
              </el-select>
            </el-form-item>
            
            <el-form-item label="Â≠ó‰ΩìÂ§ßÂ∞è">
              <el-input-number 
                v-model="typographySettings.fontSize" 
                :min="12" 
                :max="20" 
                @change="updateTypography"
                controls-position="right"
              />
              <span class="unit">px</span>
            </el-form-item>
            
            <el-form-item label="Â≠ó‰ΩìÁ≤óÁªÜ">
              <el-select v-model="typographySettings.fontWeight" @change="updateTypography">
                <el-option label="ÁªÜ‰Ωì" value="300" />
                <el-option label="Ê≠£Â∏∏" value="400" />
                <el-option label="‰∏≠Á≠â" value="500" />
                <el-option label="Âä†Á≤ó" value="600" />
                <el-option label="ÁâπÁ≤ó" value="700" />
              </el-select>
            </el-form-item>
            
            <el-form-item label="Ë°åÈ´ò">
              <el-input-number 
                v-model="typographySettings.lineHeight" 
                :min="1" 
                :max="2" 
                :step="0.1" 
                @change="updateTypography"
                controls-position="right"
              />
            </el-form-item>

            <el-form-item label="Â≠óÈó¥Ë∑ù">
              <el-input-number 
                v-model="typographySettings.letterSpacing" 
                :min="-2" 
                :max="10" 
                :step="0.5" 
                @change="updateTypography"
                controls-position="right"
              />
              <span class="unit">px</span>
            </el-form-item>
          </el-form>
        </el-card>

        <!-- Êìç‰ΩúÊåâÈíÆ -->
        <div class="action-buttons">
          <el-button @click="resetToDefault" :icon="Refresh">
            ÈáçÁΩÆÈªòËÆ§
          </el-button>
          <el-button type="primary" @click="applyAllSettings" :icon="Check">
            Â∫îÁî®ËÆæÁΩÆ
          </el-button>
          <el-button type="success" @click="saveSettings" :icon="Download">
            ‰øùÂ≠òËÆæÁΩÆ
          </el-button>
        </div>
      </div>
    </el-drawer>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, computed } from 'vue'
import { ElMessage } from 'element-plus'
import { 
  Setting, 
  Check, 
  Refresh, 
  Download,
  QuestionFilled 
} from '@element-plus/icons-vue'
import { useUserStyleStore } from '@/stores/userStyle'

const userStyleStore = useUserStyleStore()
const visible = ref(false)

// ÂìçÂ∫îÂºèÊï∞ÊçÆ
const layoutSettings = reactive({
  menuPosition: 'left' as 'left' | 'right' | 'top',
  menuCollapsed: false
})

const headerStyle = reactive({
  height: '60px',
  background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
  shadow: '0 2px 8px rgba(0, 0, 0, 0.1)',
  textColor: '#ffffff'
})

const tabsStyle = reactive({
  height: '40px',
  background: '#ffffff',
  borderColor: '#e4e7ed',
  activeColor: '#409eff'
})

const backgroundSettings = reactive({
  type: 'color' as 'color' | 'image' | 'animation',
  color: '#f8f9fa',
  image: '',
  animation: 'particles',
  opacity: 1
})

const typographySettings = reactive({
  fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',
  fontSize: '14px',
  fontWeight: '400',
  lineHeight: 1.5,
  letterSpacing: '0'
})

// ËÆ°ÁÆóÂ±ûÊÄß - ‰ªéstoreËé∑ÂèñÂΩìÂâçÂÄº
const currentMenuPosition = computed(() => userStyleStore.menuPosition)
const currentMenuCollapsed = computed(() => userStyleStore.menuCollapsed)
const currentHeaderStyle = computed(() => userStyleStore.headerStyle)
const currentTabsStyle = computed(() => userStyleStore.tabsStyle)
const currentBackground = computed(() => userStyleStore.background)
const currentTypography = computed(() => userStyleStore.typography)

// ÂàùÂßãÂåñÊï∞ÊçÆ
const initData = () => {
  Object.assign(layoutSettings, {
    menuPosition: currentMenuPosition.value,
    menuCollapsed: currentMenuCollapsed.value
  })
  
  Object.assign(headerStyle, currentHeaderStyle.value)
  Object.assign(tabsStyle, currentTabsStyle.value)
  Object.assign(backgroundSettings, currentBackground.value)
  Object.assign(typographySettings, currentTypography.value)
}



// Êõ¥Êñ∞ÊñπÊ≥ï
const updateLayout = () => {
  userStyleStore.updateMenuPosition(layoutSettings.menuPosition)
  if (layoutSettings.menuCollapsed !== currentMenuCollapsed.value) {
    userStyleStore.toggleMenuCollapsed()
  }
}

const updateHeader = () => {
  userStyleStore.updateHeaderStyle(headerStyle)
}

const updateTabs = () => {
  userStyleStore.updateTabsStyle(tabsStyle)
}

const updateBackground = () => {
  userStyleStore.updateBackground(backgroundSettings)
}

const updateTypography = () => {
  userStyleStore.updateTypography(typographySettings)
}

const applyAllSettings = () => {
  updateLayout()
  updateHeader()
  updateTabs()
  updateBackground()
  updateTypography()
  ElMessage.success('ÊâÄÊúâËÆæÁΩÆÂ∑≤Â∫îÁî®')
}

const saveSettings = () => {
  // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®Ôºàstore‰∏≠Â∑≤ÂÆûÁé∞Ôºâ
  ElMessage.success('ËÆæÁΩÆÂ∑≤‰øùÂ≠òÂà∞Êú¨Âú∞')
}

const resetToDefault = () => {
  userStyleStore.resetToDefault()
  initData()
  ElMessage.success('Â∑≤ÈáçÁΩÆ‰∏∫ÈªòËÆ§ËÆæÁΩÆ')
}


</script>

<style scoped lang="scss">
.style-editor {
  display: inline-block;
}

.style-editor-content {
  padding: 20px;
  
  .el-card {
    margin-bottom: 20px;
    
    &:last-child {
      margin-bottom: 0;
    }
  }
}

.card-header {
  display: flex;
  align-items: center;
  gap: 8px;
  
  .card-title {
    font-weight: 600;
    font-size: 16px;
  }
}

.unit {
  margin-left: 8px;
  color: var(--el-text-color-secondary);
  font-size: 14px;
}

.image-preview {
  margin-top: 8px;
  
  img {
    max-width: 100%;
    max-height: 100px;
    border-radius: 4px;
    border: 1px solid var(--el-border-color-light);
  }
}

// Êìç‰ΩúÊåâÈíÆ
.action-buttons {
  display: flex;
  gap: 12px;
  justify-content: center;
  margin-top: 20px;
  padding-top: 20px;
  border-top: 1px solid var(--el-border-color-light);
}

// ÂìçÂ∫îÂºèËÆæËÆ°
@media (max-width: 768px) {
  .action-buttons {
    flex-direction: column;
  }
  
  .el-form-item {
    .el-form-item__content {
      flex-direction: column;
      align-items: flex-start;
    }
  }
}
</style>
