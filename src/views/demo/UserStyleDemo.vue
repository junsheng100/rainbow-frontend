<template>
  <div class="user-style-demo">
    <!-- é¡µé¢å¤´éƒ¨ -->
    <div class="demo-header">
      <h1>ğŸ¨ ç”¨æˆ·è‡ªå®šä¹‰æ ·å¼æ¼”ç¤º</h1>
      <p>ä½“éªŒ Rainbow View çš„å¼ºå¤§è‡ªå®šä¹‰åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä¸»é¢˜åˆ‡æ¢ã€æ ·å¼ç¼–è¾‘ã€å¸ƒå±€è°ƒæ•´ç­‰</p>
    </div>

    <!-- æ§åˆ¶é¢æ¿ -->
    <div class="control-panel">
      <el-row :gutter="20">
        <el-col :span="8">
          <el-card class="control-card">
            <template #header>
              <div class="card-header">
                <span>ğŸ¯ ä¸»é¢˜åˆ‡æ¢</span>
              </div>
            </template>
            <ThemeCustomizer />
          </el-card>
        </el-col>
        
        <el-col :span="8">
          <el-card class="control-card">
            <template #header>
              <div class="card-header">
                <span>ğŸ›ï¸ æ ·å¼ç¼–è¾‘</span>
              </div>
            </template>
            <StyleEditor />
          </el-card>
        </el-col>
        
        <el-col :span="8">
          <el-card class="control-card">
            <template #header>
              <div class="card-header">
                <span>âš¡ å¿«é€Ÿæ“ä½œ</span>
              </div>
            </template>
            <div class="quick-actions">
              <el-button type="primary" @click="toggleDarkMode" :icon="Moon">
                {{ isDarkMode ? 'å…³é—­æ·±è‰²æ¨¡å¼' : 'å¼€å¯æ·±è‰²æ¨¡å¼' }}
              </el-button>
              <el-button type="success" @click="toggleMenuPosition" :icon="Switch">
                åˆ‡æ¢èœå•ä½ç½®
              </el-button>
                             <el-button type="warning" @click="resetAllSettings" :icon="Refresh">
                 é‡ç½®æ‰€æœ‰è®¾ç½®
               </el-button>
            </div>
          </el-card>
        </el-col>
      </el-row>
    </div>

    <!-- æ ·å¼é¢„è§ˆåŒºåŸŸ -->
    <div class="preview-section">
      <el-row :gutter="20">
        <!-- è‰²å½©é¢„è§ˆ -->
        <el-col :span="12">
          <el-card class="preview-card">
            <template #header>
              <div class="card-header">
                <span>ğŸŒˆ è‰²å½©é¢„è§ˆ</span>
              </div>
            </template>
            <div class="color-preview">
              <div class="color-item primary">
                <span class="color-label">ä¸»è‰²è°ƒ</span>
                <span class="color-value">{{ themeColors.primary }}</span>
              </div>
              <div class="color-item success">
                <span class="color-label">æˆåŠŸè‰²</span>
                <span class="color-value">{{ themeColors.success }}</span>
              </div>
              <div class="color-item warning">
                <span class="color-label">è­¦å‘Šè‰²</span>
                <span class="color-value">{{ themeColors.warning }}</span>
              </div>
              <div class="color-item danger">
                <span class="color-label">å±é™©è‰²</span>
                <span class="color-value">{{ themeColors.danger }}</span>
              </div>
              <div class="color-item info">
                <span class="color-label">ä¿¡æ¯è‰²</span>
                <span class="color-value">{{ themeColors.info }}</span>
              </div>
            </div>
          </el-card>
        </el-col>

        <!-- ç»„ä»¶é¢„è§ˆ -->
        <el-col :span="12">
          <el-card class="preview-card">
            <template #header>
              <div class="card-header">
                <span>ğŸ§© ç»„ä»¶é¢„è§ˆ</span>
              </div>
            </template>
            <div class="component-preview">
              <div class="preview-item">
                <h4>æŒ‰é’®æ ·å¼</h4>
                <div class="button-group">
                  <el-button type="primary">ä¸»è¦æŒ‰é’®</el-button>
                  <el-button type="success">æˆåŠŸæŒ‰é’®</el-button>
                  <el-button type="warning">è­¦å‘ŠæŒ‰é’®</el-button>
                  <el-button type="danger">å±é™©æŒ‰é’®</el-button>
                </div>
              </div>
              
              <div class="preview-item">
                <h4>è¾“å…¥æ¡†æ ·å¼</h4>
                <el-input placeholder="è¯·è¾“å…¥å†…å®¹" />
              </div>
              
              <div class="preview-item">
                <h4>å¡ç‰‡æ ·å¼</h4>
                <div class="custom-card">
                  <div class="card-header">
                    <h5>è‡ªå®šä¹‰å¡ç‰‡</h5>
                  </div>
                  <div class="card-body">
                    <p>è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨è‡ªå®šä¹‰æ ·å¼çš„å¡ç‰‡ç»„ä»¶</p>
                  </div>
                </div>
              </div>
            </div>
          </el-card>
        </el-col>
      </el-row>
    </div>

    <!-- å¸ƒå±€é¢„è§ˆ -->
    <div class="layout-preview">
      <el-card class="preview-card">
        <template #header>
          <div class="card-header">
            <span>ğŸ“± å¸ƒå±€é¢„è§ˆ</span>
          </div>
        </template>
        <div class="layout-info">
          <el-descriptions :column="3" border>
            <el-descriptions-item label="èœå•ä½ç½®">
              <el-tag :type="getMenuPositionType()">{{ menuPositionLabel }}</el-tag>
            </el-descriptions-item>
            <el-descriptions-item label="èœå•çŠ¶æ€">
              <el-tag :type="menuCollapsed ? 'warning' : 'success'">
                {{ menuCollapsed ? 'å·²æŠ˜å ' : 'å·²å±•å¼€' }}
              </el-tag>
            </el-descriptions-item>
            <el-descriptions-item label="å½“å‰ä¸»é¢˜">
              <el-tag type="primary">{{ currentTheme }}</el-tag>
            </el-descriptions-item>
            <el-descriptions-item label="å¤´éƒ¨é«˜åº¦">
              {{ headerStyle.height }}
            </el-descriptions-item>
            <el-descriptions-item label="æ ‡ç­¾é«˜åº¦">
              {{ tabsStyle.height }}
            </el-descriptions-item>
            <el-descriptions-item label="èƒŒæ™¯ç±»å‹">
              <el-tag :type="getBackgroundType()">{{ backgroundTypeLabel }}</el-tag>
            </el-descriptions-item>
          </el-descriptions>
        </div>
      </el-card>
    </div>

    <!-- ä»£ç ç¤ºä¾‹ -->
    <div class="code-examples">
      <el-card class="preview-card">
        <template #header>
          <div class="card-header">
            <span>ğŸ’» ä»£ç ç¤ºä¾‹</span>
          </div>
        </template>
        <div class="code-tabs">
          <el-tabs v-model="activeTab" type="border-card">
            <el-tab-pane label="ä¸»é¢˜åˆ‡æ¢" name="theme">
              <pre class="code-block"><code>// åˆ‡æ¢ä¸»é¢˜
const themeStore = useThemeStore()
themeStore.setTheme('dark')

// è‡ªå®šä¹‰é¢œè‰²
themeStore.updateCustomColor('primary', '#FF6B6B')

// æ·±è‰²æ¨¡å¼
themeStore.toggleDarkMode()</code></pre>
            </el-tab-pane>
            
            <el-tab-pane label="æ ·å¼ç¼–è¾‘" name="style">
              <pre class="code-block"><code>// æ›´æ–°èœå•ä½ç½®
const userStyleStore = useUserStyleStore()
userStyleStore.updateMenuPosition('right')

// æ›´æ–°å¤´éƒ¨æ ·å¼
userStyleStore.updateHeaderStyle({
  height: '80px',
  background: 'linear-gradient(45deg, #FF6B6B, #4ECDC4)'
})

// æ›´æ–°èƒŒæ™¯
userStyleStore.updateBackground({
  type: 'animation',
  animation: 'particles',
  opacity: 0.8
})</code></pre>
            </el-tab-pane>
            
            <el-tab-pane label="CSSå˜é‡" name="css">
              <pre class="code-block"><code>/* CSSå˜é‡ä½¿ç”¨ */
:root {
  --primary-color: #409EFF;
  --header-height: 60px;
  --border-radius: 6px;
}

.custom-button {
  background-color: var(--primary-color);
  border-radius: var(--border-radius);
}</code></pre>
            </el-tab-pane>
          </el-tabs>
        </div>
      </el-card>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed } from 'vue'
import { ElMessage } from 'element-plus'
import { Moon, Switch, Refresh } from '@element-plus/icons-vue'
import ThemeCustomizer from '@/components/ThemeCustomizer/index.vue'
import StyleEditor from '@/components/StyleEditor/index.vue'
import { useThemeStore } from '@/stores/theme'
import { useUserStyleStore } from '@/stores/userStyle'

const themeStore = useThemeStore()
const userStyleStore = useUserStyleStore()
const activeTab = ref('theme')

// è®¡ç®—å±æ€§
const themeColors = computed(() => themeStore.themeColors)
const currentTheme = computed(() => themeStore.currentTheme)
const isDarkMode = computed(() => themeStore.darkMode)
const menuPosition = computed(() => userStyleStore.menuPosition)
const menuCollapsed = computed(() => userStyleStore.menuCollapsed)
const headerStyle = computed(() => userStyleStore.headerStyle)
const tabsStyle = computed(() => userStyleStore.tabsStyle)
const background = computed(() => userStyleStore.background)

// æ ‡ç­¾æ˜¾ç¤º
const menuPositionLabel = computed(() => {
  const labels = { left: 'å·¦ä¾§', right: 'å³ä¾§', top: 'é¡¶éƒ¨' }
  return labels[menuPosition.value] || 'å·¦ä¾§'
})

const backgroundTypeLabel = computed(() => {
  const labels = { color: 'çº¯è‰²', image: 'å›¾ç‰‡', animation: 'åŠ¨ç”»' }
  return labels[background.value.type] || 'çº¯è‰²'
})

// æ–¹æ³•
const toggleDarkMode = () => {
  themeStore.toggleDarkMode()
  ElMessage.success(isDarkMode.value ? 'å·²å¼€å¯æ·±è‰²æ¨¡å¼' : 'å·²å…³é—­æ·±è‰²æ¨¡å¼')
}

const toggleMenuPosition = () => {
  const positions = ['left', 'right', 'top'] as const
  const currentIndex = positions.indexOf(menuPosition.value)
  const nextIndex = (currentIndex + 1) % positions.length
  const nextPosition = positions[nextIndex]
  
  userStyleStore.updateMenuPosition(nextPosition)
  ElMessage.success(`èœå•ä½ç½®å·²åˆ‡æ¢è‡³${menuPositionLabel.value}`)
}

const resetAllSettings = () => {
  themeStore.resetToDefault()
  userStyleStore.resetToDefault()
  ElMessage.success('æ‰€æœ‰è®¾ç½®å·²é‡ç½®ä¸ºé»˜è®¤å€¼')
}

const getMenuPositionType = () => {
  const types = { left: 'primary', right: 'success', top: 'warning' }
  return types[menuPosition.value] || 'primary'
}

const getBackgroundType = () => {
  const types = { color: 'info', image: 'success', animation: 'warning' }
  return types[background.value.type] || 'info'
}
</script>

<style scoped lang="scss">
.user-style-demo {
  padding: 20px;
  max-width: 1200px;
  margin: 0 auto;
}

.demo-header {
  text-align: center;
  margin-bottom: 30px;
  
  h1 {
    color: var(--primary-color);
    margin-bottom: 16px;
  }
  
  p {
    color: var(--text-color-secondary);
    font-size: var(--font-size-lg);
  }
}

.control-panel {
  margin-bottom: 30px;
}

.control-card {
  height: 100%;
  
  .card-header {
    font-weight: 600;
    font-size: 16px;
  }
}

.quick-actions {
  display: flex;
  flex-direction: column;
  gap: 12px;
  
  .el-button {
    width: 100%;
  }
}

.preview-section {
  margin-bottom: 30px;
}

.preview-card {
  height: 100%;
  
  .card-header {
    font-weight: 600;
    font-size: 16px;
  }
}

.color-preview {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.color-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px;
  border-radius: var(--border-radius);
  color: #ffffff;
  font-weight: 500;
  
  &.primary { background-color: var(--primary-color); }
  &.success { background-color: var(--success-color); }
  &.warning { background-color: var(--warning-color); }
  &.danger { background-color: var(--danger-color); }
  &.info { background-color: var(--info-color); }
  
  .color-value {
    font-family: monospace;
    font-size: 12px;
    opacity: 0.9;
  }
}

.component-preview {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.preview-item {
  h4 {
    margin-bottom: 12px;
    color: var(--text-color);
    font-size: 14px;
  }
}

.button-group {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.custom-card {
  background: var(--card-bg);
  border: 1px solid var(--card-border);
  border-radius: var(--card-radius);
  
  .card-header {
    padding: 12px 16px;
    border-bottom: 1px solid var(--card-border);
    background-color: var(--bg-color);
    
    h5 {
      margin: 0;
      color: var(--text-color);
    }
  }
  
  .card-body {
    padding: 16px;
    
    p {
      margin: 0;
      color: var(--text-color-secondary);
    }
  }
}

.layout-preview {
  margin-bottom: 30px;
}

.layout-info {
  .el-descriptions {
    .el-descriptions__label {
      font-weight: 600;
    }
  }
}

.code-examples {
  margin-bottom: 30px;
}

.code-tabs {
  .code-block {
    background-color: var(--bg-color);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    padding: 16px;
    margin: 0;
    font-family: var(--font-family-monospace);
    font-size: 14px;
    line-height: 1.5;
    color: var(--text-color);
    overflow-x: auto;
    
    code {
      background: none;
      padding: 0;
      color: inherit;
    }
  }
}

// å“åº”å¼è®¾è®¡
@media (max-width: 768px) {
  .user-style-demo {
    padding: 16px;
  }
  
  .control-panel {
    .el-col {
      margin-bottom: 20px;
    }
  }
  
  .preview-section {
    .el-col {
      margin-bottom: 20px;
    }
  }
  
  .button-group {
    flex-direction: column;
    
    .el-button {
      width: 100%;
    }
  }
}
</style>
